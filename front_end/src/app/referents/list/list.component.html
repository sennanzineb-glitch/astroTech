<div class="container mt-3">

  <!-- ================= PAGE HEADER ================= -->
  <div class="page-header mb-3">
    <h3 class="page-title mb-1">RÃ©fÃ©rents</h3>
    <nav aria-label="breadcrumb">
      <ol class="breadcrumb mb-0">
        <li class="breadcrumb-item"><a href="#">RÃ©fÃ©rents</a></li>
        <li class="breadcrumb-item">liste des rÃ©fÃ©rents</li>
      </ol>
    </nav>
  </div>

  <!-- ================= AJOUT AFFAIRE ================= -->
  <button type="button" class="btn btn-gradient-success mb-3" (click)="addReferent()">
    â• Ajouter un rÃ©fÃ©rent
  </button>

  <div class="row g-3">
    <!-- CHAQUE REFERENT DANS UNE CARD -->
    <div class="col-md-6" *ngFor="let ref of referents">
      <div class="card shadow-sm p-3 h-100">

        <!-- HEADER CARD -->
        <div class="d-flex justify-content-between align-items-center mb-2">
          <h5 class="mb-0">{{ ref.nom }} {{ ref.prenom }}</h5>
          <div class="d-flex gap-1">
            <!-- Bouton Edit -->
            <button class="btn btn-sm btn-outline-warning" [routerLink]="['/referents/edit', ref.id]">
              âœï¸ Modifier
            </button>
            <!-- Bouton Supprimer -->
            <button class="btn btn-sm btn-outline-danger" (click)="deleteReferent(ref.id)">
              ğŸ—‘ Supprimer
            </button>
          </div>
        </div>

        <!-- INFOS CONTACT -->
        <p class="mb-2" style="font-size: 0.9rem;">
          <strong>Email:</strong> {{ ref.email }}<br>
          <strong>TÃ©lÃ©phone:</strong> {{ ref.telephone }}
        </p>

        <!-- AJOUT FICHIERS -->
        <div class="mb-2">
          <label class="form-label" style="font-size: 0.85rem;">Fichiers Ã  ajouter</label>
          <div class="border rounded p-2 d-flex align-items-center justify-content-between gap-2">

            <button class="btn btn-outline-primary btn-sm" type="button" (click)="fileInput.click()">
              ğŸ“‚ Choisir des fichiers
            </button>

            <div class="flex-grow-1 ms-2 text-truncate" style="max-width: 50%; font-size: 0.75rem;">
              {{ newFilesNames }}
            </div>

            <button class="btn btn-success btn-sm ms-2" type="button" [disabled]="newFiles.length === 0"
              (click)="uploadFiles(ref)">
              ğŸ“¤ Upload
            </button>

            <input type="file" #fileInput class="d-none" multiple (change)="onFileSelected($event)" />
          </div>

          <!-- Fichiers sÃ©lectionnÃ©s avant upload -->
          <ul class="list-group mt-2" *ngIf="newFiles.length > 0">
            <li class="list-group-item d-flex justify-content-between align-items-center py-1"
              *ngFor="let file of newFiles; let i = index">
              {{ file.name }}
              <button class="btn btn-sm btn-outline-danger" (click)="removeNewFile(i)">âœ•</button>
            </li>
          </ul>
        </div>

        <!-- FICHIERS UPLOADES -->
        <h6 style="font-size: 0.85rem;">Fichiers associÃ©s</h6>
        <ul class="list-group" *ngIf="ref.fichiers?.length > 0">
          <li class="list-group-item d-flex justify-content-between align-items-center" *ngFor="let f of ref.fichiers">
            <a [href]="url_upload + '/' + f.chemin" target="_blank">{{ f.nom }}</a>
            <button class="btn btn-sm btn-outline-danger" (click)="removeUploadedFile(f.id, ref)">ğŸ—‘</button>
          </li>
        </ul>
        <div class="text-muted mt-2" *ngIf="!ref.fichiers?.length">
          Aucun fichier associÃ©
        </div>

      </div>
    </div>
  </div>
</div>